---
title: "`genophenoR`: a R package for the analysis of Simon Simplex collection, clinical and variant data"
author: "Alba Gutierrez-Sacristan, Romain Guedj, Laura I. Furlong and Paul Avillach"
date: "`r doc_date()`"
vignette: >
  %\VignetteIndexEntry{Bioconductor style for HTML documents}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
output: 
  BiocStyle::html_document
---

# Introduction

The `genophenoR` package contains functions to query Simon Simplex Collection [@REF1], a database containing clinical and molecular information about autistic patients and their families. The `genophenoR` package includes analysis functions to study demographic and phenotypic variables, and their co-occurrence in general population and according to a gene mutation status. A special focus is made on visualization of the results, providing a variety of representation formats such as networks, heatmaps and barplots.

## Background
The Simons Simplex Collection (SSC) is a core project and resource of the Simons Foundation Autism Research Initiative (SFARI). The SSC achieved its primary goal to establish a permanent repository of genetic samples from 2,600 simplex families, each of which has one child affected with an autism spectrum disorder, and unaffected parents and siblings.

Each genetic sample has an associated collection of data that provides a precise characterization, or phenotype, of the individual. Rigorous phenotyping maximizes the value of the resource for a wide variety of future research projects on the causes and mechanisms of autism.


With `genophenoR` package the user is able to perform a variety of analysis on the molecular and clinical data, and visualize the results through different types of graphical representations.

The tasks that can be performed with `genophenoR` package are the following:

  1. Demographic descriptive analysis based on age and gender. 
  2. Phenotype descriptive analysis taking into account continuous and categorical variables. 
  3. Phenotype prevalence and co-occurrence analysis according to age, gender and gene mutation status. 
  4. Extract those patients that have been diagnosed with a determined pair of phenotypes. 


In the following sections the specific functions that can be used to address each of these tasks are presented.

## Installation

The package \texttt{genophenoR} is provided through GitHub. To install \texttt{genophenoR} the user must type the two following commands in an R session:

```{r bioC, eval=FALSE}
install_github("hms-dbmi/genophenoR")
```

```{r load_library, message=FALSE}
library(genophenoR)
```

## genopheno object

`genopheno` object is obtained when `queryGenoPheno` function is applied. This object is used as input for `demographicSummary` and `phenotypeSummary`  descriptive functions. The `genophenoR.SSC` object contains the table dataset and shows the main characteristic of our dataset:
  * The number of mutations variables
  * The number of phenotypes variables
  * The number of patients 
  

```{r genophenoR.SSC1, echo=FALSE}
load("C:/Users/AG440/Desktop/genophenoR/inst/extdata/genophenoExData.RData")
genophenoExData
```

```{r genophenoR.SSC2}
genophenoExData
class( genophenoExData )
```



# Descriptive demographics analysis with genophenoR
The function `demographicSummary` describes the demographic characteristics (sex, age) of the population under study.
The `demographicSummary` function requires three arguments:
  * input: the genopheno object.
  * maleCode: the symbol which denotes males in the table (e.g., 0, M, Male...etc)
  * femaleCode: the symbol which denotes females in the table (e.g., 1, F, Female...etc)


The `demographicSummary` function output includes:
  * A barplot with the age distribution of the whole study population
  * A boxplot showing the age distribution by gender.
  * A pie chart representing the gender distribution.

```{r search_gene_1, fig.width=6, fig.height=6}
demographicSummary (input = genophenoExData, 
                    maleCode    = "MALE", 
                    femaleCode  ="FEMALE")
```


# Descriptive phenotypic analysis

The function `phenotypeSummary` describes the phenotypic characteristics for the whole study population then according to the status regarding one selected gene.    

The `phenotypeSummary` function requires 2 arguments:  
  * input: the `genopheno` object.
  * mutation: the mutation of interest
  * ifile: to create a file summarizing the information displayed in the barplots. It will be saved in your working directory.
  * showTable: the table is displayed before the barplot. 

The `phenotypeSummary` function output includes:   
* A barplot for each categorical phenotype variable
* A boxplot for each continuous phenotype variable
* A table if the showTable argument is TRUE

```{r phenosumm, fig.width=10, fig.height=8}
phenotypeSummary(input      = genophenoExData,
                 mutation   = "CHD8", 
                 showTable  = TRUE)
```


# Phenotypes co-occurrence and prevalence using 

The `genoPhenoComorbidity` identifies all the possible phenotype co-ocurrence and quantify them.  Five different quantification measures are estimated:   
- fisher test with Benjamini-Hochberg FDR (Benjamini et al. 2001)  
- comorbidity score (Roque et al. 2011)   
- relative risk (Christakis et al. 2009)   
- Pearson correlation   
- odds ratio. 

According to the type of study, the user can select the co-ocurence measures needed as well as the cut-off value. As a result of the phenotype co-occurrence analysis, a table containing the different estimated measurements is obtained. 


The `genoPhenoComorbidity` function requires 6 arguments:  
* input: the `genopheno` object
* pth: the path where the file with the phenotype values generated previously is located.
* aggregate: if all the possible phenotypes values want to be considered individually, aggregate must be FALSE. Otherwhise, the phenotype values should be manually completed by the user (column yes/no) and aggregate must be TRUE. 
* ageRange: determines what is the age range of interest for performing the analysis.
* gender: determine what is the gender of interest for performing the co-occurrence analysis.
* mutation: determine the mutation of interest and the value of this mutation.

The `genoPhenoComorbidity` function output is an object named `genophenoComo` that contains: 
- Several information
- A table with the co-occurence results


## Phenotype co-occurrence

```{r phenoCooccurrence}
genophenoComorCHD8no <- genoPhenoComorbidity( 
              input         = genophenoExData,
              pth           = "C:/Users/AG440/Desktop/genophenoR/inst/extdata/",
              aggregate    = FALSE, 
              ageRange      = c(4,18),
              gender        = "ALL", 
              mutation      = c("CHD8", "no")
              )
genophenoComorCHD8no
```


## Phenotype co-occurrence visualization

### Network

The function `genoPhenoNetwork`  displays these results as a heatmap. 

The `genoPhenoNetwork` function requires 3 arguments:  
* input: the `genophenoComor` object
* selectValue: the co-occurence measurement 
* cutOff: the numeral value of the cutOff

The `genoPhenoNetowrk` function output is a network. Node size is proportional to the phenotype prevalence. Edge numbers represent the selected value. 

```{r phenoNetwork, fig.width=6, fig.height=6}
genoPhenoNetwork ( input       = genophenoComorCHD8no,
                   selectValue = "PercentagePhenoAB", 
                  cutOff      = 10)
```



### Heatmap

The function `genoPhenoHeatmap`  displays these results as a heatmap. 

The `genoPhenoHeatmap` function requires 3 arguments:  
* input: the `genophenoComor` object
* selectValue: the co-occurence measurement 
* cutOff: the numeral value of the cutOff

The `genoPhenoHeatmap` function output is a heatmap. Blue color represents the lower values,  red color represets the upper values. The co-occurence measurement value is showed in each cell. 

```{r phenoHeatmap, fig.width=8, fig.height=8}
genoPhenoHeatmap ( input       = genophenoComorCHD8no,
                   selectValue = "PercentagePhenoAB", 
                   cutOff      = 0)
```

### Prevalence

The function `genophenoPrevalence`  displays in a data frame:
    * Phenotype
    * Number of patients (N_patients)
    * Prevalence
    * Confidence interval



```{r genophenoPrevalence}
prevalence <- genoPhenoPrevalence( input = genophenoComorCHD8no )
prevalence
```

# References



\end{document}